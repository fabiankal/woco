---
title: "Work and Corona Dashboard"
output: flexdashboard::flex_dashboard
runtime: shiny
---

```{r global, include=FALSE}
library(plotly)
library(tidyr)
library(rlang)
# load data in 'global' chunk so it can be shared by all users of the dashboard
data <-readr::read_csv("https://raw.githubusercontent.com/fabiankal/woco/master/output/tables/export_shiny_data.csv")

my_autocomplete_list <- unique(data$variable)

```

Column {.sidebar}
-----------------------------------------------------------------------

Choose wisely.

```{r}
selectizeInput(
    inputId = 'variables',
    label = 'Variablen',
    choices = my_autocomplete_list,
    selected = my_autocomplete_list[1],
    multiple = TRUE, # allow for multiple inputs
    options = list(create = FALSE), # if TRUE, allows newly created inputs
  )
selectInput("groupby", label = "Gruppierung",
            choices = c("Keine","Gender", "Age", "Education", "Region","Income"), selected = "Keine")

checkboxInput(inputId = 'confidence', label = "95% Konfidenzintervalle", value = FALSE)
checkboxInput(inputId = 'incidence', label = "7-Tages Inzidenz", value = FALSE)
checkboxInput(inputId = 'relevantdates', label = "Relevante Ergeignisse", value = FALSE)

sliderInput("bw_adjust", label = "Bandwidth adjustment:",
            min = 0.2, max = 2, value = 1, step = 0.2)

```

Column
-----------------------------------------------------------------------

### Line Plot

```{r}

#output$out1 <- renderPrint(input$variables)
#verbatimTextOutput('out1')

# output$out1 <- renderPrint({data %>% select(wavedate,variable,mean_measurement,ymax_mean,ymin_mean) %>% 
#     distinct(wavedate,variable, .keep_all = TRUE) %>% 
#     filter(variable %in% input$variables) %>%  
#     pivot_wider(id_cols = c(wavedate,variable),names_from=variable, values_from=c(mean_measurement,ymax_mean,ymin_mean), names_glue = "{variable}_{.value}")})
# verbatimTextOutput('out1')

#eventReactive(input$groupby, { })

renderPlotly({
  data2 = data %>% select(wavedate,variable,mean_measurement,ymax_mean,ymin_mean) %>%
    distinct(wavedate,variable, .keep_all = TRUE) %>%
    filter(variable %in% input$variables) #%>%
    #pivot_wider(id_cols = c(wavedate,variable),names_from=variable, values_from=c(mean_measurement,ymax_mean,ymin_mean), names_glue = "{variable}_{.value}")

  p <- data2 %>%
  plot_ly(x = ~wavedate, y= ~mean_measurement,mode = 'lines+markers',linetype=~variable)
  p <- p %>% layout(title = "Average agreement",
         xaxis = list(title = ""),
         yaxis = list (title = ""),
         legend = list(orientation = 'h'))
  p
})

```

### Infos

```{r}

tags$a("The scale of this variable goes from ",tags$strong("X")," to.",tags$strong("Y"))

output$out1 <- renderPrint(input$groupby)
verbatimTextOutput('out1')

renderPlotly({
  data2 = data %>% select(wavedate,variable,mean_measurement,ymax_mean,ymin_mean) %>%
    distinct(wavedate,variable, .keep_all = TRUE) %>%
    filter(variable %in% input$variables) %>%
    filter(grouping %in% input$groupby)

  p <- data2 %>%
  plot_ly(x = ~wavedate, y= ~mean_measurement,mode = 'lines+markers',linetype=~grouping)
  p <- p %>% layout(title = "Average agreement",
         xaxis = list(title = ""),
         yaxis = list (title = ""),
         legend = list(orientation = 'h'))
  p
})

```
